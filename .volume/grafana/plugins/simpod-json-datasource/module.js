define(["react","@grafana/ui","@grafana/runtime","lodash","@grafana/data"],(function(e,t,n,r,i){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=7)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=i},function(e,t,n){"use strict";(function(e){var r=n(0);function i(t){var n;n="undefined"!=typeof window?window:"undefined"!=typeof self?self:e;var r,i,a="undefined"!=typeof document&&document.attachEvent;if(!a){var o=(i=n.requestAnimationFrame||n.mozRequestAnimationFrame||n.webkitRequestAnimationFrame||function(e){return n.setTimeout(e,20)},function(e){return i(e)}),s=(r=n.cancelAnimationFrame||n.mozCancelAnimationFrame||n.webkitCancelAnimationFrame||n.clearTimeout,function(e){return r(e)}),l=function(e){var t=e.__resizeTriggers__,n=t.firstElementChild,r=t.lastElementChild,i=n.firstElementChild;r.scrollLeft=r.scrollWidth,r.scrollTop=r.scrollHeight,i.style.width=n.offsetWidth+1+"px",i.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight},u=function(e){if(!(e.target.className&&"function"==typeof e.target.className.indexOf&&e.target.className.indexOf("contract-trigger")<0&&e.target.className.indexOf("expand-trigger")<0)){var t=this;l(this),this.__resizeRAF__&&s(this.__resizeRAF__),this.__resizeRAF__=o((function(){(function(e){return e.offsetWidth!=e.__resizeLast__.width||e.offsetHeight!=e.__resizeLast__.height})(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach((function(n){n.call(t,e)})))}))}},c=!1,d="",f="animationstart",p="Webkit Moz O ms".split(" "),h="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),_=document.createElement("fakeelement");if(void 0!==_.style.animationName&&(c=!0),!1===c)for(var g=0;g<p.length;g++)if(void 0!==_.style[p[g]+"AnimationName"]){d="-"+p[g].toLowerCase()+"-",f=h[g],c=!0;break}var m="resizeanim",v="@"+d+"keyframes "+m+" { from { opacity: 0; } to { opacity: 0; } } ",y=d+"animation: 1ms "+m+"; "}return{addResizeListener:function(e,r){if(a)e.attachEvent("onresize",r);else{if(!e.__resizeTriggers__){var i=e.ownerDocument,o=n.getComputedStyle(e);o&&"static"==o.position&&(e.style.position="relative"),function(e){if(!e.getElementById("detectElementResize")){var n=(v||"")+".resize-triggers { "+(y||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',r=e.head||e.getElementsByTagName("head")[0],i=e.createElement("style");i.id="detectElementResize",i.type="text/css",null!=t&&i.setAttribute("nonce",t),i.styleSheet?i.styleSheet.cssText=n:i.appendChild(e.createTextNode(n)),r.appendChild(i)}}(i),e.__resizeLast__={},e.__resizeListeners__=[],(e.__resizeTriggers__=i.createElement("div")).className="resize-triggers";var s=i.createElement("div");s.className="expand-trigger",s.appendChild(i.createElement("div"));var c=i.createElement("div");c.className="contract-trigger",e.__resizeTriggers__.appendChild(s),e.__resizeTriggers__.appendChild(c),e.appendChild(e.__resizeTriggers__),l(e),e.addEventListener("scroll",u,!0),f&&(e.__resizeTriggers__.__animationListener__=function(t){t.animationName==m&&l(e)},e.__resizeTriggers__.addEventListener(f,e.__resizeTriggers__.__animationListener__))}e.__resizeListeners__.push(r)}},removeResizeListener:function(e,t){if(a)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",u,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(f,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(e){}}}}}var a=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},u=function(e){function t(){var e,n,r;a(this,t);for(var i=arguments.length,o=Array(i),s=0;s<i;s++)o[s]=arguments[s];return n=r=l(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),r.state={height:r.props.defaultHeight||0,width:r.props.defaultWidth||0},r._onResize=function(){var e=r.props,t=e.disableHeight,n=e.disableWidth,i=e.onResize;if(r._parentNode){var a=r._parentNode.offsetHeight||0,o=r._parentNode.offsetWidth||0,s=window.getComputedStyle(r._parentNode)||{},l=parseInt(s.paddingLeft,10)||0,u=parseInt(s.paddingRight,10)||0,c=parseInt(s.paddingTop,10)||0,d=parseInt(s.paddingBottom,10)||0,f=a-c-d,p=o-l-u;(!t&&r.state.height!==f||!n&&r.state.width!==p)&&(r.setState({height:a-c-d,width:o-l-u}),i({height:a,width:o}))}},r._setRef=function(e){r._autoSizer=e},l(r,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"componentDidMount",value:function(){var e=this.props.nonce;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,this._detectElementResize=i(e),this._detectElementResize.addResizeListener(this._parentNode,this._onResize),this._onResize())}},{key:"componentWillUnmount",value:function(){this._detectElementResize&&this._parentNode&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize)}},{key:"render",value:function(){var e=this.props,t=e.children,n=e.className,i=e.disableHeight,a=e.disableWidth,o=e.style,l=this.state,u=l.height,c=l.width,d={overflow:"visible"},f={},p=!1;return i||(0===u&&(p=!0),d.height=0,f.height=u),a||(0===c&&(p=!0),d.width=0,f.width=c),Object(r.createElement)("div",{className:n,ref:this._setRef,style:s({},d,o)},!p&&t(f))}}]),t}(r.PureComponent);u.defaultProps={onResize:function(){},disableHeight:!1,disableWidth:!1,style:{}},t.a=u}).call(this,n(6))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.r(t);var r=n(4),i=n(1),a=n(0),o=n.n(a),s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};var l=function(){return(l=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}var c,d=n(3),f=n(5);!function(e){e.Table="table",e.Timeseries="timeseries"}(c||(c={}));var p=[{label:"Time series",value:c.Timeseries},{label:"Table",value:c.Table}],h=n(2),_=["adhoc","constant","custom","query","textbox"],g=function(e){function t(t){var n=e.call(this,t)||this;return n.url=void 0===t.url?"":t.url,n.withCredentials=void 0!==t.withCredentials,n.headers={"Content-Type":"application/json"},"string"==typeof t.basicAuth&&t.basicAuth.length>0&&(n.headers.Authorization=t.basicAuth),n}return function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.query=function(e){var t=this.processTargets(e);return 0===t.targets.length?Promise.resolve({data:[]}):(t.adhocFilters=Object(h.getTemplateSrv)().getAdhocFilters(this.name),e.scopedVars=l(l({},this.getVariables()),e.scopedVars),this.doRequest({url:this.url+"/query",data:t,method:"POST"}))},t.prototype.testDatasource=function(){return this.doRequest({url:this.url,method:"GET"}).then((function(e){return 200===e.status?{status:"success",message:"Data source is working",title:"Success"}:{status:"error",message:"Data source is not working: "+e.message,title:"Error"}}))},t.prototype.metricFindQuery=function(e,t,n){var r={type:n,target:Object(h.getTemplateSrv)().replace(e,void 0,"regex")};return this.doRequest({url:this.url+"/search",data:r,method:"POST"}).then(this.mapToTextValue)},t.prototype.getTagKeys=function(e){var t=this;return new Promise((function(n){t.doRequest({url:t.url+"/tag-keys",method:"POST",data:e}).then((function(e){return n(e.data)}))}))},t.prototype.getTagValues=function(e){var t=this;return new Promise((function(n){t.doRequest({url:t.url+"/tag-values",method:"POST",data:e}).then((function(e){return n(e.data)}))}))},t.prototype.annotationQuery=function(e){var t={annotation:{query:Object(h.getTemplateSrv)().replace(e.annotation.query,{},"glob"),name:e.annotation.name,datasource:e.annotation.datasource,enable:e.annotation.enable,iconColor:e.annotation.iconColor},range:e.range,rangeRaw:e.rangeRaw,variables:this.getVariables()};return this.doRequest({url:this.url+"/annotations",method:"POST",data:t}).then((function(e){return e.data}))},t.prototype.mapToTextValue=function(e){return e.data.map((function(e,t){return e&&e.text&&e.value?{text:e.text,value:e.value}:Object(d.isObject)(e)?{text:e,value:t}:{text:e,value:e}}))},t.prototype.doRequest=function(e){return e.withCredentials=this.withCredentials,e.headers=this.headers,Object(h.getBackendSrv)().datasourceRequest(e)},t.prototype.processTargets=function(e){var t=this;return e.targets=e.targets.filter((function(e){return void 0!==e.target})).map((function(n){return""!==n.data.trim()&&("string"==typeof n.data&&(n.data=n.data.replace(Object(h.getTemplateSrv)().regex,(function(n){return t.cleanMatch(n,e)}))),n.data=JSON.parse(n.data)),"string"==typeof n.target&&(n.target=Object(h.getTemplateSrv)().replace(n.target.toString(),e.scopedVars,"regex")),n})),e},t.prototype.cleanMatch=function(e,t){var n=Object(h.getTemplateSrv)().replace(e,t.scopedVars,"json");return"string"==typeof n&&'"'===n[0]&&'"'===n[n.length-1]?JSON.parse(n):n},t.prototype.getVariables=function(){var e={};return Object.values(Object(h.getTemplateSrv)().getVariables()).forEach((function(t){if(_.includes(t.type)&&"adhoc"!==t.type){var n=t,r=n.current.value;("$__all"===r||Object(d.isEqual)(r,["$__all"]))&&(r=null===n.allValue||""===n.allValue?n.options.slice(1).map((function(e){return e.value})):n.allValue),e[n.id]={text:n.current.text,value:r}}})),e},t}(r.DataSourceApi);n.d(t,"plugin",(function(){return v}));var m=function(){function e(){}return e.templateUrl="partials/annotations.editor.html",e}(),v=new r.DataSourcePlugin(g).setAnnotationQueryCtrl(m).setConfigEditor((function(e){var t=e.options,n=e.onOptionsChange;return o.a.createElement(o.a.Fragment,null,o.a.createElement(i.DataSourceHttpSettings,{defaultUrl:"http://localhost:8080",dataSourceConfig:t,showAccessOptions:!0,onChange:n}))})).setQueryEditor((function(e){var t,n,r=e.datasource,a=e.onChange,s=e.onRunQuery,c=e.query,h=u(o.a.useState(null!==(t=Object(d.find)(p,(function(e){return e.value===c.type})))&&void 0!==t?t:p[0]),2),_=h[0],g=h[1],m=u(o.a.useState(),2),v=m[0],y=m[1],b=u(o.a.useState(null!==(n=c.data)&&void 0!==n?n:""),2),w=b[0],z=b[1],T=u(o.a.useState(null),2),S=T[0],O=T[1],E=u(o.a.useState([]),2),x=E[0],j=E[1],R=u(o.a.useState(!1),2),C=R[0],L=R[1],N=o.a.useCallback((function(e){var t=e.value;return r.metricFindQuery("",void 0,t).then((function(e){var t=e.map((function(e){return{label:e.text,value:e.value}})),n=Object(d.find)(t,(function(e){return e.value===c.target}));return y(void 0===n?{label:"",value:""}:n),t}),(function(e){throw y({label:"",value:""}),j([]),new Error(e.statusText)}))}),[r,c.target]),A=o.a.useCallback((function(e){L(!0),N(e).then((function(e){j(e)})).finally((function(){L(!1)}))}),[N,j,L]);return o.a.useEffect((function(){A(_)}),[_,A]),o.a.useEffect((function(){void 0!==(null==v?void 0:v.value)&&""!==(null==v?void 0:v.value)&&(null!==S&&(null==v?void 0:v.value)===S.metric&&_.value===S.format&&w===S.data||(O({data:w,metric:v.value,format:_.value}),a(l(l({},c),{data:w,target:v.value,type:_.value})),s()))}),[w,_,v]),o.a.createElement(o.a.Fragment,null,o.a.createElement(i.InlineFieldRow,null,o.a.createElement(i.InlineField,null,o.a.createElement(i.Select,{prefix:"Format As: ",options:p,defaultValue:_,onChange:function(e){g(e)}})),o.a.createElement(i.InlineField,null,o.a.createElement(i.Select,{isLoading:C,prefix:"Metric: ",options:x,placeholder:"Select metric",allowCustomValue:!0,value:v,onChange:function(e){y(e)}}))),o.a.createElement(i.InlineFieldRow,null,o.a.createElement(f.a,{disableHeight:!0},(function(e){var t=e.width;return o.a.createElement("div",{style:{width:t+"px"}},o.a.createElement(i.InlineLabel,null,"Body"),o.a.createElement(i.CodeEditor,{width:"100%",height:"200px",language:"json",showLineNumbers:!0,showMiniMap:w.length>100,value:w,onBlur:function(e){return z(e)}}))}))))}))}])}));
//# sourceMappingURL=module.js.map